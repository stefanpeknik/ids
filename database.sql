-- Drop a table

DROP TABLE OFFENSE;

DROP TABLE PERSON;

-- create table for Offense that is commited by Driver and is commited in Motor vehicle
CREATE TABLE OFFENSE (
    OFFENSE_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    OFFENSE_DATE_TIME DATE, -- type DATE contains date as well as time so offense_time ommited
    OFFENSE_LOCATION_STREET VARCHAR( 100 ) NOT NULL,
    OFFENSE_LOCATION_CITY VARCHAR( 50 ) NOT NULL,
    OFFENSE_LOCATION_STATE VARCHAR( 2 ) NOT NULL DEFAULT 'CZ', -- should always be CZ
    OFFENSE_LOCATION_ZIP VARCHAR2( 5 ) CONSTRAINT OFFENSE_LOCATION_ZIP_CHECK CHECK (REGEXP_LIKE(OFFENSE_LOCATION_ZIP, '^\\d{5}\\s\\(\\d{3}\\s\\d{2}\\)$')),
    OFFENSE_TYPE VARCHAR2( 50 ),
    OFFENSE_DESCRIPTION VARCHAR2( 500 ), -- description of the offense
    OFFENSE_POINTS INT NOT NULL CONSTRAINT OFFENSE_POINTS_CHECK CHECK ( OFFENSE_POINTS >= 0 AND OFFENSE_POINTS <= 12 ),
    OFFENSE_FINE INT DEFAULT 0 NOT NULL, -- always in czech crowns
    OFFENSE_LABEL VARCHAR2( 50 )
);

-- create table for Person that is either Driver (who commits an offense and is licensed to drive a motor vehicle) or Vehicle owner
CREATE TABLE PERSON (
    PERSON_ID INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PERSON_NAME VARCHAR2( 50 ) NOT NULL,
    PERSON_SURNAME VARCHAR2( 50 ) NOT NULL,
    PERSON_AGE INT NOT NULL CONSTRAINT PERSON_AGE_CHECK CHECK ( PERSON_AGE >= 0 ),
    PERSON_SEX VARCHAR2( 1 ) NOT NULL CONSTRAINT PERSON_SEX_CHECK CHECK (PERSON_SEX == 'M' OR PERSON_SEX == 'F'),
    PERSON_GENDER VARCHAR2 ( 50 ), -- gender is not always male or female, so it is not constrained
    INSURANCE_ID INT FOREIGN KEY REFERENCE INSURANCE (INSURANCE_ID), -- insurance that that Person is under, can be null
    PERSON_PERSONAL_ID VARCHAR2( 10 ) NOT NULL CONSTRAINT PERSON_PERSONAL_ID_CHECK CHECK (REGEXP_LIKE(PERSON_PERSONAL_ID, '^(\\d{2})(\\d{2})(\\d{2})\\/?(\\d{3,4})$')), -- does not contain / or - in the middle
    PERSON_BIRTH_DATE DATE NOT NULL,
    PERSON_STREET VARCHAR2( 100 ) NOT NULL,
    PERSON_HOUSE_NUMBER INT NOT NULL,
    PERSON_CITY VARCHAR2( 50 ) NOT NULL,
    PERSON_STATE VARCHAR2( 2 ) NOT NULL DEFAULT 'CZ', -- should always be CZ
    PERSON_ZIP VARCHAR2( 5 ) CONSTRAINT PERSON_ZIP_CHECK CHECK (REGEXP_LIKE(PERSON_ZIP, '^\\d{5}\\s\\(\\d{3}\\s\\d{2}\\)$')),
    DRIVER_ID INT FOREIGN KEY REFERENCE DRIVER (DRIVER_ID), -- if Person is a Driver, this is not null
    VEHICLE_OWNER_ID INT FOREIGN KEY REFERENCE VEHICLE_OWNER (VEHICLE_OWNER_ID) -- if Person is a Vehicle owner, this is not null
);

